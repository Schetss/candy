jsFrontend.location={map:{},mapFullUrl:null,directionService:null,directionsDisplay:null,init:function(){$(".parseMap").length>0&&$(".parseMap").each(function(){var e=$(this).attr("id").replace("map","");google.maps.event.addDomListener(window,"load",jsFrontend.location.initMap(e))})},initMap:function(e){var n=""==e?"":"_"+e,t=""==e?"general":e,o={zoom:"auto"==jsFrontend.data.get("Location.settings"+n+".zoom_level")?0:parseInt(jsFrontend.data.get("Location.settings"+n+".zoom_level")),center:new google.maps.LatLng(jsFrontend.data.get("Location.settings"+n+".center.lat"),jsFrontend.data.get("Location.settings"+n+".center.lng")),mapTypeId:google.maps.MapTypeId[jsFrontend.data.get("Location.settings"+n+".map_type")]};jsFrontend.location.map[t]=new google.maps.Map(document.getElementById("map"+e),o);var a=jsFrontend.data.get("Location.items"+n);if(a.length>0)for(var r in a)jsFrontend.location.addMarker(t,a[r].id,a[r].lat,a[r].lng,a[r].title);jsFrontend.data.get("Location.settings"+n+".directions")&&(null==jsFrontend.location.directionsService&&(jsFrontend.location.directionsService=new google.maps.DirectionsService),null==jsFrontend.location.directionsDisplay&&(jsFrontend.location.directionsDisplay=new google.maps.DirectionsRenderer),$("#locationSearch"+e+" form").on("submit",function(n){n.preventDefault(),jsFrontend.location.setRoute(e,t,a[0])})),$("#map-full-url-"+e).length>0&&(jsFrontend.location.mapFullUrl=$("#map-full-url-"+e).attr("href"))},addMarker:function(e,n,t,o,a){var r="http://candy:8888/src/Frontend/Themes/candy/Core/Layout/images/",i=new google.maps.Marker({position:new google.maps.LatLng(t,o),map:jsFrontend.location.map[e],icon:r+"maps_icon.png",title:a,locationId:n});google.maps.event.addListener(i,"click",function(){$markerText=$("#markerText"+i.locationId),$markerText.length>0&&(text=$markerText.html());var n="";"undefined"!=typeof text&&(n+=text),new google.maps.InfoWindow({content:n}).open(jsFrontend.location.map[e],i)})},setRoute:function(e,n,t){$error=$("#locationSearchError"+e),$search=$("#locationSearchAddress"+e),""==$search.val()?$error.show():$error.hide();var o=new google.maps.LatLng(t.lat,t.lng),a={origin:$search.val(),destination:o,travelMode:google.maps.DirectionsTravelMode.DRIVING};jsFrontend.location.directionsService.route(a,function(t,a){if(a==google.maps.DirectionsStatus.OK){if(jsFrontend.location.directionsDisplay.setMap(jsFrontend.location.map[n]),jsFrontend.location.directionsDisplay.setDirections(t),null!=jsFrontend.location.mapFullUrl){var r=$("#map-full-url-"+e),i=jsFrontend.location.mapFullUrl+"&f=d&saddr="+$search.val()+"&daddr="+o;r.attr("href",i)}}else $error.show()})}},$(jsFrontend.location.init);